<ContentPage
    x:Class="KakaoBotAT.MobileClient.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:KakaoBotAT.MobileClient.ViewModels"
    Title="AT KakaoTalk Bot Listener"
    x:DataType="vm:MainViewModel">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <Label
                FontAttributes="Bold"
                FontSize="Title"
                Text="KakaoTalk Bot Settings" />
            <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

            <!--  Server Address Configuration  -->
            <Label FontSize="Medium" Text="Server Endpoint URL (ASP.NET REST API)" />
            <Entry
                Keyboard="Url"
                Placeholder="http://your-server-ip:port/api/kakao"
                Text="{Binding ServerAddress}" />

            <!--  Permissions and Status Check  -->
            <Label
                Margin="0,10,0,0"
                FontAttributes="Bold"
                FontSize="Medium"
                Text="Permissions and Optimization Status" />

            <Border BackgroundColor="{StaticResource Gray100}" StrokeShape="RoundRectangle 5">
                <VerticalStackLayout Padding="5" Spacing="5">
                    <Label FontAttributes="Bold" Text="{Binding NotificationStatus}" />
                    <Button
                        Command="{Binding OpenNotificationSettingsCommand}"
                        IsEnabled="{Binding IsBotRunning, Converter={StaticResource InverseBooleanConverter}}"
                        Text="Open Notification Listener Settings" />

                    <BoxView
                        Margin="0,5"
                        HeightRequest="1"
                        Color="{StaticResource Gray300}" />

                    <Label FontAttributes="Bold" Text="{Binding BatteryOptStatus}" />
                    <Button
                        Command="{Binding RequestBatteryOptimizationExemptionCommand}"
                        IsEnabled="{Binding IsBotRunning, Converter={StaticResource InverseBooleanConverter}}"
                        Text="Request Battery Optimization Exemption" />
                </VerticalStackLayout>
            </Border>

            <!--  Status Update and Bot Toggle Buttons  -->
            <Grid
                Margin="0,10,0,0"
                ColumnDefinitions="*, *"
                ColumnSpacing="10">
                <Button
                    Grid.Column="0"
                    Command="{Binding UpdateStatusesCommand}"
                    Text="Update Status" />
                <Button
                    Grid.Column="1"
                    BackgroundColor="{Binding IsBotRunning, Converter={StaticResource BooleanToColorConverter}, ConverterParameter='Red|Green'}"
                    Command="{Binding ToggleBotRunningCommand}"
                    FontAttributes="Bold"
                    Text="{Binding IsBotRunning, Converter={StaticResource BooleanToTextConverter}, ConverterParameter='Stop Bot|Start Bot'}"
                    TextColor="White" />
            </Grid>

            <!--  Bot Operation Log  -->
            <Label
                Margin="0,10,0,0"
                FontAttributes="Bold"
                FontSize="Medium"
                Text="Bot Operation Log" />

            <Border Padding="10" Stroke="{StaticResource Gray300}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="5" />
                </Border.StrokeShape>

                <ScrollView HeightRequest="300">
                    <Label
                        FontSize="Small"
                        LineBreakMode="WordWrap"
                        Text="{Binding LogText}" />
                </ScrollView>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>